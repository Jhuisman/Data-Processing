<!DOCTYPE html

<html>
    <head>
        <title>Graph</title>
            <form id='form1' style="position:relative">
                <h1 id='pos' style="position:absolute; left:0px; top:0px;">
                    <canvas id = "canvas", width="630", height="450"></canvas>
                </h1> 
                <h2 id='repos' style="position:absolute; left:80px; top:50px;">
                    <canvas id = "canvas2", width="550", height="350"></canvas> 
                </h2>
            </form>
    </head>
    
    <body>
        <p>
<textarea id="rawdata" visibility: hidden>
2000/01/01,61
2000/01/02,73
2000/01/03,84
2000/01/04,64
2000/01/05,44
2000/01/06,72
2000/01/07,61
2000/01/08,54
2000/01/09,8
2000/01/10,-8
2000/01/11,21
2000/01/12,7
2000/01/13,20
2000/01/14,29
2000/01/15,32
2000/01/16,54
2000/01/17,64
2000/01/18,66s
2000/01/19,39
2000/01/20,52
2000/01/21,52
2000/01/22,47
2000/01/23,11
2000/01/24,-28
2000/01/25,5
2000/01/26,24
2000/01/27,24
2000/01/28,32
2000/01/29,90
2000/01/30,91
2000/01/31,97
2000/02/01,90
2000/02/02,74
2000/02/03,64
2000/02/04,76
2000/02/05,84
2000/02/06,76
2000/02/07,79
2000/02/08,86
2000/02/09,65
2000/02/10,58
2000/02/11,46
2000/02/12,45
2000/02/13,52
2000/02/14,45
2000/02/15,66
2000/02/16,37
2000/02/17,36
2000/02/18,49
2000/02/19,48
2000/02/20,22
2000/02/21,22
2000/02/22,28
2000/02/23,51
2000/02/24,78
2000/02/25,54
2000/02/26,34
2000/02/27,76
2000/02/28,92
2000/02/29,65
2000/03/01,53
2000/03/02,49
2000/03/03,69
2000/03/04,19
2000/03/05,32
2000/03/06,63
2000/03/07,96
2000/03/08,111
2000/03/09,107
2000/03/10,65
2000/03/11,87
2000/03/12,77
2000/03/13,77
2000/03/14,78
2000/03/15,60
2000/03/16,80
2000/03/17,82
2000/03/18,70
2000/03/19,58
2000/03/20,51
2000/03/21,60
2000/03/22,72
2000/03/23,72
2000/03/24,88
2000/03/25,86
2000/03/26,63
2000/03/27,56
2000/03/28,41
2000/03/29,59
2000/03/30,65
2000/03/31,61
2000/04/01,62
2000/04/02,100
2000/04/03,119
2000/04/04,101
2000/04/05,48
2000/04/06,48
2000/04/07,55
2000/04/08,66
2000/04/09,93
2000/04/10,59
2000/04/11,61
2000/04/12,62
2000/04/13,59
2000/04/14,69
2000/04/15,89
2000/04/16,93
2000/04/17,107
2000/04/18,106
2000/04/19,119
2000/04/20,134
2000/04/21,137
2000/04/22,133
2000/04/23,111
2000/04/24,113
2000/04/25,149
2000/04/26,149
2000/04/27,152
2000/04/28,158
2000/04/29,119
2000/04/30,125
2000/05/01,128
2000/05/02,104
2000/05/03,120
2000/05/04,134
2000/05/05,181
2000/05/06,201
2000/05/07,192
2000/05/08,193
2000/05/09,196
2000/05/10,198
2000/05/11,184
2000/05/12,189
2000/05/13,181
2000/05/14,192
2000/05/15,208
2000/05/16,202
2000/05/17,137
2000/05/18,114
2000/05/19,103
2000/05/20,108
2000/05/21,100
2000/05/22,114
2000/05/23,138
2000/05/24,140
2000/05/25,132
2000/05/26,136
2000/05/27,124
2000/05/28,94
2000/05/29,101
2000/05/30,98
2000/05/31,125
2000/06/01,151
2000/06/02,164
2000/06/03,181
2000/06/04,167
2000/06/05,123
2000/06/06,128
2000/06/07,123
2000/06/08,155
2000/06/09,212
2000/06/10,166
2000/06/11,148
2000/06/12,162
2000/06/13,169
2000/06/14,172
2000/06/15,151
2000/06/16,132
2000/06/17,149
2000/06/18,211
2000/06/19,257
2000/06/20,259
2000/06/21,205
2000/06/22,163
2000/06/23,151
2000/06/24,135
2000/06/25,127
2000/06/26,124
2000/06/27,123
2000/06/28,124
2000/06/29,132
2000/06/30,137
2000/07/01,136
2000/07/02,190
2000/07/03,194
2000/07/04,176
2000/07/05,158
2000/07/06,165
2000/07/07,140
2000/07/08,127
2000/07/09,138
2000/07/10,152
2000/07/11,133
2000/07/12,139
2000/07/13,145
2000/07/14,132
2000/07/15,128
2000/07/16,142
2000/07/17,136
2000/07/18,140
2000/07/19,161
2000/07/20,163
2000/07/21,146
2000/07/22,151
2000/07/23,165
2000/07/24,184
2000/07/25,170
2000/07/26,155
2000/07/27,165
2000/07/28,170
2000/07/29,159
2000/07/30,168
2000/07/31,183
2000/08/01,210
2000/08/02,182
2000/08/03,173
2000/08/04,165
2000/08/05,166
2000/08/06,175
2000/08/07,186
2000/08/08,173
2000/08/09,184
2000/08/10,187
2000/08/11,189
2000/08/12,176
2000/08/13,217
2000/08/14,217
2000/08/15,182
2000/08/16,183
2000/08/17,179
2000/08/18,176
2000/08/19,186
2000/08/20,175
2000/08/21,156
2000/08/22,153
2000/08/23,155
2000/08/24,156
2000/08/25,163
2000/08/26,195
2000/08/27,167
2000/08/28,144
2000/08/29,146
2000/08/30,139
2000/08/31,144
2000/09/01,157
2000/09/02,145
2000/09/03,149
2000/09/04,138
2000/09/05,154
2000/09/06,151
2000/09/07,159
2000/09/08,174
2000/09/09,173
2000/09/10,170
2000/09/11,184
2000/09/12,176
2000/09/13,160
2000/09/14,152
2000/09/15,166
2000/09/16,155
2000/09/17,130
2000/09/18,159
2000/09/19,174
2000/09/20,148
2000/09/21,137
2000/09/22,154
2000/09/23,165
2000/09/24,147
2000/09/25,152
2000/09/26,169
2000/09/27,161
2000/09/28,158
2000/09/29,169
2000/09/30,159
2000/10/01,138
2000/10/02,124
2000/10/03,127
2000/10/04,122
2000/10/05,121
2000/10/06,92
2000/10/07,84
2000/10/08,101
2000/10/09,96
2000/10/10,94
2000/10/11,104
2000/10/12,117
2000/10/13,116
2000/10/14,98
2000/10/15,103
2000/10/16,123
2000/10/17,102
2000/10/18,99
2000/10/19,107
2000/10/20,113
2000/10/21,149
2000/10/22,149
2000/10/23,146
2000/10/24,122
2000/10/25,122
2000/10/26,102
2000/10/27,108
2000/10/28,132
2000/10/29,101
2000/10/30,105
2000/10/31,92
2000/11/01,76
2000/11/02,78
2000/11/03,77
2000/11/04,68
2000/11/05,71
2000/11/06,94
2000/11/07,85
2000/11/08,82
2000/11/09,78
2000/11/10,71
2000/11/11,86
2000/11/12,87
2000/11/13,79
2000/11/14,56
2000/11/15,57
2000/11/16,72
2000/11/17,50
2000/11/18,64
2000/11/19,91
2000/11/20,63
2000/11/21,62
2000/11/22,86
2000/11/23,84
2000/11/24,70
2000/11/25,72
2000/11/26,76
2000/11/27,66
2000/11/28,119
2000/11/29,111
2000/11/30,106
2000/12/01,116
2000/12/02,105
2000/12/03,84
2000/12/04,70
2000/12/05,96
2000/12/06,109
2000/12/07,98
2000/12/08,122
2000/12/09,94
2000/12/10,96
2000/12/11,120
2000/12/12,131
2000/12/13,108
2000/12/14,74
2000/12/15,56
2000/12/16,41
2000/12/17,25
2000/12/18,32
2000/12/19,27
2000/12/20,16
2000/12/21,-1
2000/12/22,-23
2000/12/23,-20
2000/12/24,6
2000/12/25,-6
2000/12/26,-22
2000/12/27,-10
2000/12/28,5
2000/12/29,6
2000/12/30,17
2000/12/31,-1</textarea>   

        </p>
        <script type= "text/javascript">

            //verkrijgen data en plaatsen in arrays als waarden
            var dates = [];
            var aveCels = [];
            var data_array = document.getElementById('rawdata').innerHTML.split("\n");
                        
                for (var i = 1; i < 366; i++)
                {
                    var buffer = data_array[i].split(",");
                    dates.push(new Date(buffer[0]));
                    aveCels.push((buffer[1])/10);
                }


            //functie van data naar pixelcoordinaten
            function createTransform(domain, range){
                var alpha = (range[1] - range[0])/(domain[1] - domain[0]);
                var beta = range[1] - alpha*domain[1];

                return function(x){
                    return alpha * x + beta;
                };
            }
            
            // transform dates into milliseconds
            var dates_milli = [];
            for ( var i = 0; i < dates.length; i++){
                dates_milli.push( dates[i].getTime());
            }

            //console.log("Dates_milli", dates_milli);
            //console.log("AveCels", aveCels);
            
            // canvas herkennen
            var canvas = document.getElementById("canvas");
            var context = canvas.getContext("2d");
            
            // transform de waarden voor x- en y-as in pixel waarden
            var transformx = createTransform([0, 364], [80, canvas.width]);
            transformed_x = [];
            for (var i = 1; i < 366; i++){
                buffer = transformx(i);
                transformed_x.push(buffer);
            }
            //console.log("Transformed_x", transformed_x);

            var transformy = createTransform([-5, 30], [(canvas.height)-50,50]);
            transformed_y = [];
            for (var i = 0; i < aveCels.length; i++){
                buffer = transformy(aveCels[i]);
                transformed_y.push(buffer);
            }
            //console.log("Transformed_y", transformed_y);

            context.beginPath();
            context.moveTo(80, transformed_y[0]);
            
            // draw the line gemiddelde temperatuur per dag
            context.lineWidth=3;
            context.strokeStyle = 'red';
            for (var i = 0; i < 365; i++){

                var xvalue = transformed_x[i];
                var yvalue = transformed_y[i];
                context.lineTo(xvalue,yvalue);
            }
            context.stroke();
            context.closePath();

            // reset line
            context.lineWidth=1;
            context.strokeStyle = 'black';

            // yas
            context.beginPath();
            var y_linestart = transformy(-5);
            var y_lineend = transformy(30);
            var interval = (y_linestart - y_lineend) /8;
            context.moveTo(80, y_linestart);
            context.lineTo(80, y_lineend);
            context.stroke();
            context.closePath();

            // yas intervallen om de 5 graden cels
            context.beginPath();
            var y_interval_val = transformy(0);
            var interval_y = y_interval_val - y_linestart;
            var yaswaarde = -5;
            context.font="15px Verdana";
            for(var i = 0; i < 8; i++){
                context.moveTo(75, y_linestart);
                context.lineTo(80, y_linestart);
                context.moveTo(80, y_linestart);
                context.lineTo(630, y_linestart);
                context.fillText(yaswaarde, 50, y_linestart);
                yaswaarde = yaswaarde + 5;
                y_linestart = y_linestart + interval_y;
            }
            context.stroke();
            context.closePath();

            // xas
            context.beginPath();
            y_linestart = transformy(-5);
            var x_lineend = 80 + transformx(364);
            context.moveTo(80, y_linestart);
            context.lineTo(630, y_linestart);
            context.stroke();
            context.closePath();

            // xas intervallen
            var months = ["jan", "feb", "mar", "apr", "mei", "jun", "jul", "aug", "sep", "okt", "nov", "dec"];
            var month_ave = ["4.3","5.8","6.8","9.9","14.7","16.0","15.5","17.4","15.8","11.3","7.7","5.0"];

            context.beginPath();
            x_linestart = 80;
            var x_interval = 550/12
            for(var i = 0; i < 12; i++){
                context.moveTo(x_linestart, y_linestart);
                if (i == 0){
                    context.font="18px Verdana";
                    context.fillText("Maand:", (x_linestart - 80), (y_linestart + 26));
                    context.fillText("Gem.C:", (x_linestart - 80), (y_linestart + 46));
                }
                context.font="15px Verdana";
                context.lineTo(x_linestart, (y_linestart +5));
                context.fillText(months[i], (x_linestart + 8), (y_linestart + 25));
                context.fillText(month_ave[i], (x_linestart + 8), (y_linestart + 47));
                x_linestart = x_linestart + x_interval;
            }
            context.stroke();
            context.restore();
            context.closePath();

            //y-as title
            context.font="20px Verdana";
            context.fillText("(C.)", 7, 200);
            context.font="25px Verdana";
            context.fillText("Gemiddelde temperatuur anno: 2000", 100, 20);
        
            //canvas herkennen etc.
            var canvas2 = document.getElementById("canvas2");
            var context2 = canvas2.getContext("2d");
            x_leftborder = 0;
            x_rightborder = 550;
            y_topborder = 0;
            y_lowborder = 350;

            // functie om temperatuur op crosshair te laten zien linksbovenin de hoek
            // PSEUDOCODE, eerst nog doorrekenen wat exacte temp is op de plaats.
            //function writeMessage(canvas, message) {
            //    context2.clearRect(0, 0, canvas2.width, canvas2.height);
             //   context2.font = '18pt Calibri';
             //   context2.fillStyle = 'black';
              //  context2.fillText(message, 10, 25);
                
            //}

            // verkrijgen coordinaten van muis
            function getMousePos(canvas, evt) {
                var rect = canvas2.getBoundingClientRect();
                return {
                    x: evt.clientX - rect.left,
                    y: evt.clientY - rect.top,
                };
            }

            //functie van data naar pixelcoordinaten
            function createTransform_backx(domain, range){
                var alpha = (domain[1] - domain[0])/(range[1] - range[0]);
                var beta = domain[1] - alpha*range[1];

                return function(x){
                    return alpha * x + beta;
                };
            }

            var transformx_back = createTransform_backx([0, 365], [0, canvas2.width]);

            // crosshair tekenen aan de hand van punt, in 4 richtingen
            function crosshair(yvalue, xvalue) {
                context2.clearRect(0, 0, canvas2.width, canvas2.height);   
                context2.beginPath();
                //up from position
                context2.moveTo(xvalue, yvalue);
                context2.lineTo(xvalue, y_topborder);
                //down from position
                context2.moveTo(xvalue, yvalue);
                context2.lineTo(xvalue,y_lowborder);
                //left
                context2.moveTo(xvalue, yvalue);
                context2.lineTo(x_leftborder, yvalue);
                //right
                context2.moveTo(xvalue, yvalue);
                context2.lineTo(x_rightborder, yvalue);
                context2.stroke();
                context2.closePath();
            }

            // wanneer muis over canvas2 bereken coordinaat voor y en geef temperatuur van die dag weer
            // lIJKT DE CROSSHAIR NIET TE KUNNEN BEREIKEN.....
            canvas2.addEventListener('mousemove', function(evt) {
                var mousePos = getMousePos(canvas, evt); 
                var mousePos = getMousePos(canvas, evt);
                var x_on_line = transformx_back(mousePos.x);
                var rounded_x = Math.round(x_on_line);
                var y_on_line = transformed_y[rounded_x];
                var y_in_chart = ((y_on_line - 350) + 350); 
                //console.log("Tempcoord:", y_in_chart);  

                //var message = 'Temp: ' + rounded_x + ',' + abs_y_value;
                var yvalue = y_in_chart;
                var xvalue = mousePos.x;
                crosshair(yvalue, xvalue);
                //writeMessage(canvas, message);         

            }, false);







        </script>
    </body>
</html>